# 1. 持久化

* **简介**
  * 把数据保存到可掉电式存储设备中以供之后使用。大多数情况下，特别是企业级应用，数据持久化意味着将内存中的数据保存到硬盘上加以”固化”，而持久化的实现过程大多通过各种关系数据库来完成
* **作用**
  * 将内存中的数据存储在关系型数据库中，当然也可以存储在磁盘文件、XML数据文件中

* **示例**

  ![image-20231210110334741](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312101103805.png)



# 2. 数据库相关概念

* **DB: 数据库(database)**
  * 即存储数据的“仓库”，其本质是一个文件系统。它保存了一系列有组织的数据

    ![image-20231211101654720](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312111016786.png)
  
* **DBMS：数据库管理系统（Database Management System)**
  * 是一种操纵和管理数据库的大型软件，用于建立、使用和维护数据库，对数据库进行统一管理和控制。用户通过数据库管理系统访问数据库中表内的数据
  
    ![image-20231211101745821](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312111017862.png)
  
* **SQL：结构化查询语言（Structured Query Language)**



# 3. 数据库与数据库管理系统的关系

* 简介
  * 数据库管理系统(DBMS)可以管理多个数据库，一般开发人员会针对每一个应用创建一个数据库。为保存应用中实体的数据，一般会在数据库创建多个表，以保存程序中实体用户的数据。数据库管理系统、数据库和表的关系如图所示:

![image-20231210110606525](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312101106579.png)

* 总结

  * 虽然在安装MySQL的时候, 会安装客户端和服务端, 服务端才是MySQL的核心

    ![image-20231210110951924](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312101109949.png)

    ![image-20231210110911150](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312101109205.png)



# 4. RDMS和非RDMS

## 4.1. 关系型数据库(RDMS)

* 这种类型的数据库是最古老的数据库类型, 关系型数据库模型是把复杂的数据结构归结为简单的二元关系(即二维表格关系)

  ![image-20231212094623637](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312120946706.png)

* 关系型数据库以行（row）和列（column）的形式存储数据,以便用户理解。这一系列的行和列被称为表（table）

* 表与表之间的数据记录有关系（relationship）。现实世界中的各种实体以及实体之间的各种联系均用关系模型来表示。关系型数据库就是在关系模型基础上的数据库

* **SQL就是关系型数据库的查询语言**

  

## 4.2. 非关系型数据库(非RDMS)

### 4.2.1 **简介**

* 非关系型数据库，可看成传统关系型数据库的功能的阉割版本，基于键值对存储数据，不需要经过SQL层的解析，性能非常高。同时减少不常用的功能，进一步提高性能
* 相比于 SQL，NoSQL 泛指非关系型数据库，包括了榜单上的键值型数据库、文档型数据库、搜索引擎和列存储等，除此以外还包括图形数据库。也只有用 NoSQL 一词才能将这些技术囊括进来

### 4.2.2 **键值型数据库键值型数据库**

* 通过 Key-Value 键值的方式来存储数据，其中 Key 和 Value 可以是简单的对象，也可以是复杂的对象。Key 作为唯一的标识符，优点是查找速度快，在这方面明显优于关系型数据库，缺点是无法像关系型数据库一样使用条件过滤（比如 WHERE），如果你不知道去哪里找数据，就要遍历所有的键，这就会消耗大量的计算。键值型数据库典型的使用场景是作为内存缓存
* Redis是最流行的键值型数据库

### **4.2.3 文档型数据库**

* 此类数据库可存放并获取文档，可以是XML、JSON等格式。在数据库中文档作为处理信息的基本单位，一个文档就相当于一条记录。文档数据库所存放的文档，就相当于键值数据库所存放的“值”。MongoDB是最流行的文档型数据库。此外，还有CouchDB等

### 4.2.4 **搜索引擎数据库**

* 虽然关系型数据库采用了索引提升检索效率，但是针对全文索引效率却较低。搜索引擎数据库是应用在搜索引擎领域的数据存储形式，由于搜索引擎会爬取大量的数据，并以特定的格式进行存储，这样在检索的时候才能保证性能最优。核心原理是“倒排索引”
* 典型产品：Solr、Elasticsearch、Splunk 等

* **列式数据库**

  ![image-20231212100210911](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312121002975.png)

  * 列式数据库是相对于行式存储的数据库，Oracle、MySQL、SQL Server 等数据库都是采用的行式存储（Row-based），而列式数据库是将数据按照列存储到数据库中，这样做的好处是可以大量降低系统的I/O，适合于分布式文件系统，不足在于功能相对有限
  * 典型产品：HBase等

### 4.2.5 **图形数据库**

![image-20231212100324865](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312121003920.png)

* 图形数据库，利用了图这种数据结构存储了实体（对象）之间的关系。图形数据库最典型的例子就是社交网络中人与人的关系，数据模型主要是以节点和边（关系）来实现，特点在于能高效地解决复杂的关系问题

* 图形数据库顾名思义，就是一种存储图形关系的数据库。它利用了图这种数据结构存储了实体（对象）之间的关系。关系型数据用于存储明确关系的数据，但对于复杂关系的数据存储却有些力不从心。如社交网络中人物之间的关系，如果用关系型数据库则非常复杂，用图形数据库将非常简单

* 典型产品：Neo4J、InfoGrid等

  

# 5. 关系型数据库的设计原则

## 5.1 **简介**

* 关系型数据库的典型数据结构就是数据表，这些数据表的组成都是结构化的（Structured）

* 将数据放到表中，表再放到库中

* 一个数据库中可以有多个表，每个表都有一个名字，用来标识自己

* 表名具有唯一性。表具有一些特性，这些特性定义了数据在表中如何存储，类似Java和Python中 “类”的设计

  

## 5.2. **表、记录和字段**

![image-20231212100619325](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312121030807.png)

* E-R（entity-relationship，实体-联系）模型中有三个主要概念是：实体集、属性、联系集
* 一个实体集（class）对应于数据库中的一个表（table），一个实体（instance）则对应于数据库表中的一行（row），也称为一条记录（record）。一个属性（attribute）对应于数据库表中的一列（column），也称为一个字段（field）
* ORM(Object Relational Mapping)思想: 对象关系映射。可类比其他编程语言中的一些概念，如下：
  * 数据库中的一个表  <---> Java或Python中的一个类
  * 表中的一条数据  <--->类中的一个对象（或实体）
  * 表中的一个列  <---->类中的一个字段、属性(field)



## 5.3. 表的关联关系

### 5.3.1. 简介

* 表与表之间的数据记录有关系(relationship)。现实世界中的各种实体以及实体之间的各种联系均用关系模型来表示
* 四种：一对一关联、一对多关联、多对多关联、自我引用



### 5.3.2 一对一关联（one-to-one）



* **简介** 

  在实际的开发中应用不多，因为一对一可以创建成一张表

* **建表原则**
  * 外键唯一：主表的主键和从表的外键（唯一），形成主外键关系，外键唯一
  * 外键是主键：主表的主键和从表的主键，形成主外键关系

* **举例**

  设计学生表：学号、姓名、手机号码、班级、系别、身份证号码、家庭住址、籍贯、紧急联系人、.......。学生表可以拆成为基础信息表和档案信息表，这两个表的记录是一一对应的关系

  * 基础信息表（常用信息）：学号、姓名、手机号码、班级、系别
  * 档案信息表（不常用信息）：学号、身份证号码、家庭住址、籍贯、紧急联系人、..

  ![image-20231212101619889](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312121016940.png)

  

## 5.3.3 一对多关联（one-to-many）

* 建表原则

  在从表(多方)创建一个字段，字段作为外键指向主表(一方)的主键

  ![image-20231212102647996](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312121026027.png)

* 常见场景

  ![image-20231212102759582](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312121028519.png)

  * 客户表和订单表
  * 分类表和商品表
  * 部门表和员工表





### 5.3.4 多对多关联（many-to-many）	   

* 要表示多对多关系，必须创建第三个表，该表通常称为联接表，它将多对多关系划分为两个一对多关系。将这两个表的主键都插入到第三个表中

  ![image-20231212102944321](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312121029040.png)



### 5.3.4 自我引用（self reference）

![image-20231212103115707](https://dawn1314.oss-cn-beijing.aliyuncs.com/typoraimg/202312121031745.png)

